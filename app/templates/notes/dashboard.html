{% extends "base.html" %}

{% block content %}
<div class="app-container">
    <!-- Mobile Sidebar Overlay -->
    <div class="overlay" id="sidebarOverlay"></div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="brand">Notes</div>

        <ul class="nav-links">
            <li class="nav-item active">
                <a href="#" class="nav-link" data-filter="all">
                    <span class="nav-icon"><i class="fas fa-home"></i></span>
                    Home
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" data-filter="all">
                    <span class="nav-icon"><i class="fas fa-sticky-note"></i></span>
                    Notes
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" data-filter="tags">
                    <span class="nav-icon"><i class="fas fa-hashtag"></i></span>
                    Tags
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link">
                    <span class="nav-icon"><i class="fas fa-cog"></i></span>
                    Settings
                </a>
            </li>
        </ul>

        <div class="sidebar-footer">
            {% if current_user.is_authenticated %}
            <div class="user-profile">
                <div class="avatar">{{ current_user.username[0]|upper }}</div>
                <div style="flex:1;">
                    <div style="font-weight:700; font-size:0.9rem;">{{ current_user.username }}</div>
                    <div style="font-size:0.8rem; opacity:0.7;">Free Plan</div>
                </div>
                <a href="{{ url_for('auth.logout') }}" style="color:white; opacity:0.7;" title="Logout"><i
                        class="fas fa-sign-out-alt"></i></a>
            </div>
            {% else %}
            <div class="user-profile" style="flex-direction: column; align-items: stretch; border: none; padding: 0;">
                <a href="{{ url_for('auth.login') }}" class="nav-link"
                    style="justify-content: center; background: rgba(255,255,255,0.1); margin-bottom: 0.5rem;">
                    Login
                </a>
                <a href="{{ url_for('auth.register') }}" class="nav-link"
                    style="justify-content: center; border: 1px solid rgba(255,255,255,0.2);">
                    Register
                </a>
            </div>
            {% endif %}
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <header class="top-bar">
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            <button class="icon-btn" id="themeToggleBtn" title="Toggle Theme" style="margin-right: 1rem;">
                <i class="fas fa-moon"></i>
            </button>
            <div class="search-container">
                <i class="fas fa-search" style="color:#9ca3af; margin-right:0.5rem;"></i>
                <input type="text" class="search-input" id="searchInput" placeholder="Search notes">
            </div>
            <button class="btn btn-new-note" id="createNoteBtn">
                New Note
            </button>
        </header>

        <div class="notes-container">
            <h2 style="margin-bottom:1.5rem; font-weight:700;">My Notes</h2>
            <div class="notes-grid" id="notesGrid">
                <!-- Notes injected by JS -->
            </div>
        </div>
    </main>
</div>

<!-- Modal -->
<div class="modal" id="noteModal">
    <div class="modal-content">
        <h2 style="margin-bottom:1.5rem;" id="modalTitle">Create Note</h2>
        <form id="noteForm">
            <input type="hidden" id="noteId">
            <div class="form-group">
                <input type="text" id="titleInput" class="form-input" placeholder="Title" required>
            </div>
            <div class="form-group">
                <input type="text" id="tagsInput" class="form-input" placeholder="Tags (comma separated)">
            </div>
            <div class="form-row">
                <div class="form-group" style="flex: 1; margin-right: 0.5rem;">
                    <label style="font-size: 0.8rem; opacity: 0.7;">Reminder</label>
                    <input type="datetime-local" id="reminderInput" class="form-input">
                </div>
                <div class="form-group" style="flex: 1; margin-left: 0.5rem;">
                    <label style="font-size: 0.8rem; opacity: 0.7;">AI Helpers</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <button type="button" class="btn btn-secondary" id="aiSummarizeBtn" title="Summarize"><i
                                class="fas fa-magic"></i></button>
                        <button type="button" class="btn btn-secondary" id="aiTagsBtn" title="Auto-tag"><i
                                class="fas fa-tags"></i></button>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <textarea id="contentInput" class="form-input form-textarea" placeholder="Start typing..."
                    required></textarea>
            </div>

            <div id="sharingSection"
                style="display:none; border-top: 1px solid rgba(0,0,0,0.1); padding-top: 1rem; margin-top: 1rem;">
                <h3 style="font-size: 1rem; margin-bottom: 0.5rem;">Collaborators</h3>
                <div class="form-row">
                    <input type="text" id="shareUserInput" class="form-input" placeholder="Username"
                        style="flex: 2; margin-right: 0.5rem;">
                    <select id="sharePermissionInput" class="form-input" style="flex: 1; margin-right: 0.5rem;">
                        <option value="read">Read</option>
                        <option value="write">Write</option>
                    </select>
                    <button type="button" class="btn btn-new-note" id="shareBtn" style="padding: 0 1rem;">Share</button>
                </div>
            </div>

            <div class="modal-actions">
                <div style="display: flex; gap: 0.5rem;">
                    <button type="button" class="btn btn-secondary" id="exportPdfBtn" title="Export as PDF"
                        style="display: none;"><i class="fas fa-file-pdf"></i></button>
                    <button type="button" class="btn btn-secondary" id="exportMdBtn" title="Export as MD"
                        style="display: none;"><i class="fas fa-file-code"></i></button>
                </div>
                <div style="flex:1;"></div>
                <button type="button" class="btn btn-delete" id="deleteNoteBtn" style="display:none;">Delete</button>
                <button type="button" class="btn btn-cancel" id="closeModal">Cancel</button>
                <button type="submit" class="btn btn-new-note btn-save">Save</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}